

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Removing Scattered Light from TESS Data Using the Lightkurve RegressionCorrector &#8212; MAST Notebook Repository</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="Intermediate: Retrieve TESS Pixel Response Function Images" href="../interm_tess_prf_retrieve/interm_tess_prf_retrieve.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/mastlogo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/mastlogo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to the MAST Notebook Repository!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Astrocut</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../astrocut/making_tess_cubes_and_cutouts/making_tess_cubes_and_cutouts.html">Generating Cubes and Cutouts from TESS FFIs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Astroquery</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../astroquery/intro.html">Intro</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../astroquery/nb.html">Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../astroquery/beginner_search/beginner_search.html">Beginner: Searching MAST using astroquery.mast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../astroquery/beginner_zcut/beginner_zcut.html">Beginner: Zcut and Astroquery Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../astroquery/large_downloads/large_downloads.html">Large Downloads in <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code></a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HSC</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HSC/HCV_API/HCV_API_demo.html">Hubble Catalog of Variables Notebook (API version)</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../HSC/HSCV3_API/hscv3_api.html">Hubble Source Catalog API Notebook</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../HSC/HSCV3_SMC_API/hscv3_smc_api.html">Hubble Source Catalog API Notebook: SMC Color-Magnitude Diagram</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../HSC/HSC_TAP/HSC_TAP.html">MAST Table Access Protocol Hubble Source Catalog Demo</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HSC/SWEEPS_HSCV3P1/sweeps_hscv3p1.html">Hubble Source Catalog SWEEPS Proper Motion Notebook</a></li>






















</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">IUE</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../IUE/exploring_UV_extinction_curves/exploring_UV_extinction_curves.html">Exploring UV Extinction Curves</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JWST</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../JWST/download_by_program_id/download_by_program_id.html">Accessing JWST Proposal Data in astroquery.mast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../JWST/Engineering_Database_Retreival/EDB_Retrieval.html">JWST Engineering Data Retrieval</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../JWST/SI_keyword_exoplanet_search/SI_keyword_exoplanet_search.html">JWST SI Keyword Search for Exoplanet Spectra</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kepler</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/beginner.html">Beginner Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_lightcurves/plotting_lightcurves.html">Using Kepler Data to Plot a Light Curve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_images_from_tpf/plotting_images_from_tpf.html">Plotting Images from Kepler Target Pixel Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_dvts/plotting_dvts.html">Read and Plot A Kepler Data Validation Timeseries File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_catalog_over_FFI/plotting_catalog_over_FFI.html">Plotting a Catalog over a Kepler Full Frame Image File</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/lightkurve.html">Lightkurve</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_searching_for_data/lightkurve_searching_for_data.html">Searching for <em>Kepler</em>/<em>K2</em> and <em>TESS</em> Data Products Using Lightkurve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_custom_aperture_photometry/lightkurve_custom_aperture_photometry.html">Creating Your Own Light Curves using Custom Aperture Photometry</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_combining_multiple_quarters/lightkurve_combining_multiple_quarters.html">Combining Multiple Quarters of <em>Kepler</em> Data with Lightkurve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_interactively_inspecting_TPFs_and_LCs/lightkurve_interactively_inspecting_TPFs_and_LCs.html">Interactively Inspecting Target Pixel Files and Light Curves</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/inst_noise.html">Instrumental Noise</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_1_data_gaps_and_quality_flags/instrumental_noise_1_data_gaps_and_quality_flags.html">Data Gaps and Quality Flags</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_2_spurious_signals_and_time_sampling_effects/instrumental_noise_2_spurious_signals_and_time_sampling_effects.html">Spurious Signals and Time Sampling Effects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_3_seasonal_and_detector_effects/instrumental_noise_3_seasonal_and_detector_effects.html">Seasonal and Detector Effects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_4_electronic_noise/instrumental_noise_4_electronic_noise.html">Electronic Noise</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/signals.html">Identifying Periodic Signals</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/identifying_transiting_planet_signals/identifying_transiting_planet_signals.html">Identifying Transiting Planet Signals in a <em>Kepler</em> Light Curve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/measuring_a_rotation_period/measuring_a_rotation_period.html">Measuring and Removing a Rotation Period Signal from a <em>Kepler</em> Light Curve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/visualizing_periodic_signals_using_a_river_plot/visualizing_periodic_signals_using_a_river_plot.html">Visualizing Periodic Signals Using a River Plot</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/verifying_the_location_of_a_signal/verifying_the_location_of_a_signal.html">Verifying the Location of a Signal in <em>Kepler</em> Pixel Data</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/periodograms.html">Periodograms &amp; Asteroseismology</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/creating_periodograms/creating_periodograms.html">Creating Periodograms</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star/how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star.html">How to Understand and Manipulate the Periodogram of an Oscillating Star</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/how_to_estimate_a_stars_mass_and_radius_using_asteroseismology/how_to_estimate_a_stars_mass_and_radius_using_asteroseismology.html">How to Estimate a Star’s Mass and Radius Using Asteroseismology</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">K2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../K2/TPF/TPF.html">Beginner: Read and Display A K2 Target Pixel File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../K2/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">Beginner: Read and Display a K2 Full Frame Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.html">Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MCCM</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/hyperspectral_healpix_maps.html">Working with FIMS-SPEAR Hyperspectral HEALPix Maps</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PanSTARRS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html">MAST Table Access Protocol PanSTARRS 1 DR2 Demo</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TESS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../beginner.html">Beginner Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../beginner_astroquery_dv/beginner_astroquery_dv.html">Retrieve TESS Data Validation Products with Astroquery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_how_to_use_dvt/beginner_how_to_use_dvt.html">Read and Plot A TESS Data Validation Timeseries File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">Read and Display a TESS Full Frame Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_how_to_use_lc/beginner_how_to_use_lc.html">Read and Plot A TESS Light Curve File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_how_to_use_tp/beginner_how_to_use_tp.html">Read and Display A TESS Target Pixel File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_tess_exomast/beginner_tess_exomast.html">Exoplanet Data and TESS Light Curves Using Python Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_tess_tap_search/beginner_tess_tap_search.html">Download MAST TESS Light Curves Within an FFI Footprint Using TAP</a></li>

<li class="toctree-l2"><a class="reference internal" href="../beginner_tic_search_hd209458/beginner_tic_search_hd209458.html">Search The TESS Input Catalog Centered On HD 209458.</a></li>

<li class="toctree-l2"><a class="reference internal" href="../beginner_tour_lc_tp/beginner_tour_lc_tp.html">A Tour of the Contents of the TESS 2-minute Cadence Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beginner_tesscut_astroquery/beginner_tesscut_astroquery.html">Cutout of the TESS FFIs using Astrocut and Astroquery</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../lc.html">Light Curves</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interm_gi_query/interm_gi_query.html">Intermediate:  Search and Download GI Program Light Curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interm_tasoc_lc/interm_tasoc_lc.html">Intermediate: Finding Flares and Variable Stars in TASOC Light Curves</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../FFIs.html">TESS FFIs</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../interm_tesscut_dss_overlay/interm_tesscut_dss_overlay.html">Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interm_tesscut_requests/interm_tesscut_requests.html">Intermediate: Create TESS FFI Cutout using Python Requests</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../noise.html">Instrumental Noise</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../interm_tess_prf_retrieve/interm_tess_prf_retrieve.html">Intermediate: Retrieve TESS Pixel Response Function Images</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Removing Scattered Light from <em>TESS</em> Data Using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code></a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/spacetelescope/mast_notebooks/main?urlpath=tree/notebooks/notebooks/TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/mast_notebooks/blob/main/notebooks/notebooks/TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/mast_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/mast_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Removing Scattered Light from TESS Data Using the Lightkurve RegressionCorrector</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Removing Scattered Light from <em>TESS</em> Data Using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-regressioncorrector-on-tesscut-ffi-cutouts">1. Using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> on TESSCut FFI Cutouts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-designmatrix-from-pixel-regressors">2. Creating a <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> from Pixel Regressors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-background-scattered-light-using-linear-regression">3. Removing Background Scattered Light Using Linear Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnosing-the-correction">4. Diagnosing the Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-regressioncorrector-on-tess-two-minute-cadence-target-pixel-files">5. Using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> on <em>TESS</em> Two-Minute Cadence Target Pixel Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#should-i-use-regressioncorrector-or-pldcorrector">6. Should I use <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> or <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-lightkurve-and-its-dependencies">Citing Lightkurve and its Dependencies</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="removing-scattered-light-from-tess-data-using-the-lightkurve-regressioncorrector">
<h1>Removing Scattered Light from <em>TESS</em> Data Using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code><a class="headerlink" href="#removing-scattered-light-from-tess-data-using-the-lightkurve-regressioncorrector" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Be familiar with the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>.</p></li>
<li><p>Understand how to create regressors from a <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code> object.</p></li>
<li><p>Be able to remove the scattered light background signal from <em>TESS</em> data.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>Lightkurve offers several tools to the community for removing instrument noise and systematics from data from the <em>Kepler</em>, <em>K2</em>, and <em>TESS</em> missions. This tutorial will demonstrate the use of Lightkurve’s <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> class to remove the scattered light and spacecraft motion noise from <em>TESS</em> Full Frame Images (FFIs).</p>
<p><em>TESS</em> FFIs have an additive scattered light background that has not been removed by the pipeline. This scattered light must be removed by the user. This can be done in a few ways, including a basic median subtraction. In this tutorial, we’ll show you how to use Lightkurve’s corrector tools to remove the scattered light.</p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<p>This tutorial requires the <a class="reference external" href="http://docs.lightkurve.org/"><strong>Lightkurve</strong></a> package, and also makes use of <strong><a class="reference external" href="https://numpy.org/">NumPy</a></strong> and <strong><a class="reference external" href="https://matplotlib.org/">Matplotlib</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="using-regressioncorrector-on-tesscut-ffi-cutouts">
<h2>1. Using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> on TESSCut FFI Cutouts<a class="headerlink" href="#using-regressioncorrector-on-tesscut-ffi-cutouts" title="Permalink to this heading">#</a></h2>
<p>For this tutorial we will use the <em>TESS</em> Sector 15 data of <a class="reference external" href="https://en.wikipedia.org/wiki/Tabby%27s_Star">KIC 8462852</a> (also known as Boyajian’s Star).
We’ll start by downloading the FFI data using MAST’s TESSCut service, querying it through Lightkurve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;KIC 8462852&#39;</span>  <span class="c1"># Boyajian&#39;s Star</span>
<span class="n">tpf</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_tesscut</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">cutout_size</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TessTargetPixelFile(TICID: KIC 8462852)
</pre></div>
</div>
</div>
</div>
<p>This cutout works the same as any Lightkurve target pixel file (TPF). <em>TESS</em> FFI cutouts do not have aperture masks created by the pipeline. Instead, users must create their own apertures. There are many methods we could use to do this, but for now we can create a threshold aperture, using Lightkurve’s <code class="docutils literal notranslate"><span class="pre">create_threshold_mask()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aper</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">create_threshold_mask</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the aperture to make sure it selected the star in the center and has a reasonable number of pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">aper</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/416da10bedc6d1e7e6c55c0d76f59c8ad128cffd6c7ccc84624d3e8cea7d08a1.png" src="../../../_images/416da10bedc6d1e7e6c55c0d76f59c8ad128cffd6c7ccc84624d3e8cea7d08a1.png" />
</div>
</div>
<p>Looks good. We can sum up the pixels in this aperture, and create an uncorrected light curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">aper</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/59b688cc3bb378ec3100d0b3393e53a632a10ea086ee63fff66116f114085105.png" src="../../../_images/59b688cc3bb378ec3100d0b3393e53a632a10ea086ee63fff66116f114085105.png" />
</div>
</div>
</section>
<section id="creating-a-designmatrix-from-pixel-regressors">
<h2>2. Creating a <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> from Pixel Regressors<a class="headerlink" href="#creating-a-designmatrix-from-pixel-regressors" title="Permalink to this heading">#</a></h2>
<p>The flux in the aperture appears to be dominated by scattered light. We can tell because <em>TESS</em> orbits Earth twice in each sector, thus patterns which appear twice within a sector are typically related to the <em>TESS</em> orbit (such as the scattered light effect).</p>
<p>To remove this light, we are going to detrend the light curve against some vectors which we think are predictive of this systematic noise.</p>
<p>In this case, we can use the <strong>pixels outside the aperture</strong> as vectors that are highly predictive of the systematic noise, that is, we will make the assumption that these pixels do not contain any flux from our target.</p>
<p>We can select these pixels by specifying flux outside of the aperture using Python’s bitwise invert operator <code class="docutils literal notranslate"><span class="pre">~</span></code> to take the inverse of the aperture mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regressors</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="o">~</span><span class="n">aper</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regressors</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1190, 2491)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">regressors</span></code> is now an array with shape <em>ntime</em> x <em>npixels outside of the aperture</em>. If we plot the first 30 of these pixels, we can see that they contain mostly scattered light, with some offset terms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">regressors</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">30</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/a3ef336afc633f84d2e1afb7d8a65cbb0425df5e95eeaf6f3a83bf3a889603e2.png" src="../../../_images/a3ef336afc633f84d2e1afb7d8a65cbb0425df5e95eeaf6f3a83bf3a889603e2.png" />
</div>
</div>
<p>In linear regression problems, it is common to refer to the matrix of regressors as the design matrix (also known as model matrix or regressor matrix). Lightkurve provides a convenient <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> class which is designed to help you work with detrending vectors.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> class has several convenience functions, and can be passed into Lightkurve’s corrector objects. Please consult the <a class="reference external" href="https://docs.lightkurve.org/api/lightkurve.correctors.DesignMatrix.html">DesignMatrix page</a> in the API docs for the full details on the methods and features provided by this class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dm</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">DesignMatrix</span><span class="p">(</span><span class="n">regressors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;regressors&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>regressors DesignMatrix (1190, 2491)
</pre></div>
</div>
</div>
</div>
<p>As shown above, <code class="docutils literal notranslate"><span class="pre">dm</span></code> is now a design matrix with the same shape as the input pixels. Currently, we have 2,541 pixels that we are using to detrend our light curve against. Rather than using all of the pixels, we can reduce these to their principal components using Principal Component Analysis (PCA). We do this for several reasons:</p>
<ol class="arabic simple">
<li><p>By reducing to a smaller number of vectors, we can remove some of the stochastic noise in our detrending vectors.</p></li>
<li><p>By reducing to the principal components, we can avoid pixels that have intrinsic variability (for example, from astrophysical long-period variables) that can be confused with the true astrophysical signal of our target.</p></li>
<li><p>By reducing the number of vectors, our detrending will be faster (although in this case, the detrending will still take seconds).</p></li>
</ol>
<p>The choice of the number of components is a tricky issue, but in general you should choose a number that is much smaller than the number of vectors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>regressors DesignMatrix (1190, 5)
</pre></div>
</div>
</div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">pca()</span></code> method, we have now reduced the number of components in our design matrix to five. These vectors show a combination of scattered light and spacecraft motion, which makes them suited to detrend our input light curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dm</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/fd17cf633acb87dfa6d16060080cca8fb279ef555ce61e5f5efaa8797ba1087a.png" src="../../../_images/fd17cf633acb87dfa6d16060080cca8fb279ef555ce61e5f5efaa8797ba1087a.png" />
</div>
</div>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> object provides a convenient <code class="docutils literal notranslate"><span class="pre">plot()</span></code> method to visualize the vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dm</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4b79af41a88edbcb6a45249547a1fbe0f4aa50aeb56d7bd59a296fe75ba3bc7b.png" src="../../../_images/4b79af41a88edbcb6a45249547a1fbe0f4aa50aeb56d7bd59a296fe75ba3bc7b.png" />
</div>
</div>
<p>We can now detrend the uncorrected light curve against these vectors. Lightkurve’s <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> will use linear algebra to find the combination of vectors that makes the input light curve <strong>closest to zero</strong>. To do this, we need one more component; we need an “offset” term, to be able to fit the mean level of the light curve. We can do this by appending a “constant” to our design matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">append_constant</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="removing-background-scattered-light-using-linear-regression">
<h2>3. Removing Background Scattered Light Using Linear Regression<a class="headerlink" href="#removing-background-scattered-light-using-linear-regression" title="Permalink to this heading">#</a></h2>
<p>Now that we have a design matrix, we only need to pass it into a <code class="docutils literal notranslate"><span class="pre">lightkurve.Corrector</span></code>. To use our design matrix, we can pass it to the <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>, which will detrend the input light curve against the vectors we’ve built.</p>
<p>Please consult the <a class="reference external" href="https://docs.lightkurve.org/api/lightkurve.correctors.RegressionCorrector.html">RegressionCorrector page</a> in the API docs for the full details on the methods and features provided by this class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrector</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">RegressionCorrector</span><span class="p">(</span><span class="n">uncorrected_lc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrector</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RegressionCorrector (ID: KIC 8462852)
</pre></div>
</div>
</div>
</div>
<p>To correct the light curve, we pass in our design matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">corrector</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can plot the results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original light curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected light curve&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e52a1760f3d5855f0676c5e3258483d82304ec663a74fbfc7b375f77af7fb248.png" src="../../../_images/e52a1760f3d5855f0676c5e3258483d82304ec663a74fbfc7b375f77af7fb248.png" />
</div>
</div>
<p>As shown above, the scattered light from the background has been removed. If we want to take a more in-depth look at the correction, we can use the <code class="docutils literal notranslate"><span class="pre">diagnose()</span></code> method to see what the <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> found as the best fitting solution.</p>
</section>
<section id="diagnosing-the-correction">
<h2>4. Diagnosing the Correction<a class="headerlink" href="#diagnosing-the-correction" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrector</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ff4abd2b95d46f3d5717f2163389fce2dcfd50a6f27807c890b37787784f07ac.png" src="../../../_images/ff4abd2b95d46f3d5717f2163389fce2dcfd50a6f27807c890b37787784f07ac.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> has clipped out some outliers during the fit of the trend. You can read more about the outlier removal, how to pass a cadence mask, and error propagation in the <a class="reference external" href="https://docs.lightkurve.org/api/lightkurve.correctors.RegressionCorrector.html#lightkurve.correctors.RegressionCorrector">docs</a>.</p>
<p><strong>Watch Out!</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> assumes that you want to remove the trend and set the light curve to the <strong>mean</strong> level of the <strong>uncorrected light curve</strong>. This isn’t true for <em>TESS</em> scattered light. <em>TESS</em> FFI light curves have <strong>additive background</strong>, and so we want to reduce the flux to the lowest recorded level, assuming that at that point the contribution from scattered light is approximately zero.</p>
<p>To do this, we will first need to look at the model of the background that <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> built. We can access that in the <code class="docutils literal notranslate"><span class="pre">corrector</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrector</span><span class="o">.</span><span class="n">model_lc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>LightCurve length=1190</i>
<table id="table139809563663696" class="table-striped table-bordered table-condensed">
<thead><tr><th>time</th><th>flux</th><th>flux_err</th></tr></thead>
<thead><tr><th></th><th>electron / s</th><th>electron / s</th></tr></thead>
<thead><tr><th>Time</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>1711.3882446289062</td><td>-341.18816068932756</td><td>0.0</td></tr>
<tr><td>1711.4090576171875</td><td>-341.2140788644356</td><td>0.0</td></tr>
<tr><td>1711.4298706054688</td><td>-341.96344397032135</td><td>0.0</td></tr>
<tr><td>1711.4507446289062</td><td>-341.83822804043393</td><td>0.0</td></tr>
<tr><td>1711.4715576171875</td><td>-342.1986575923547</td><td>0.0</td></tr>
<tr><td>1711.4923706054688</td><td>-342.1091946304168</td><td>0.0</td></tr>
<tr><td>1711.5132446289062</td><td>-345.8799031162398</td><td>0.0</td></tr>
<tr><td>1711.5340576171875</td><td>-347.95382323863305</td><td>0.0</td></tr>
<tr><td>1711.5548706054688</td><td>-344.85160661692044</td><td>0.0</td></tr>
<tr><td>...</td><td>...</td><td>...</td></tr>
<tr><td>1737.2003784179688</td><td>546.2058623584744</td><td>0.0</td></tr>
<tr><td>1737.2212524414062</td><td>467.26536951100206</td><td>0.0</td></tr>
<tr><td>1737.2420654296875</td><td>386.19737784157405</td><td>0.0</td></tr>
<tr><td>1737.2628784179688</td><td>307.61742929046795</td><td>0.0</td></tr>
<tr><td>1737.2837524414062</td><td>218.35482253288137</td><td>0.0</td></tr>
<tr><td>1737.3045654296875</td><td>109.60592441131212</td><td>0.0</td></tr>
<tr><td>1737.3253784179688</td><td>2.488369893869276</td><td>0.0</td></tr>
<tr><td>1737.3462524414062</td><td>-92.91965046688347</td><td>0.0</td></tr>
<tr><td>1737.3670654296875</td><td>-179.7542373614915</td><td>0.0</td></tr>
<tr><td>1737.3878784179688</td><td>-238.608124252567</td><td>0.0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">corrector</span><span class="o">.</span><span class="n">model_lc</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e12db4365785cd13731ffdcc2671911b86988c85cdff19157ff8b0727d34bacb.png" src="../../../_images/e12db4365785cd13731ffdcc2671911b86988c85cdff19157ff8b0727d34bacb.png" />
</div>
</div>
<p>As you can see above, the model drops below zero flux. This is impossible; the scattered light can’t be removing flux from our target!</p>
<p>To rectify this, we can subtract the model flux value at the 5th percentile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normalize to the 5th percentile of model flux</span>
<span class="n">model</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7fc1ee04126343742c6670d48591e5e7aeb78a98a220fbf06168565ea84e2861.png" src="../../../_images/7fc1ee04126343742c6670d48591e5e7aeb78a98a220fbf06168565ea84e2861.png" />
</div>
</div>
<p>This looks better. Now we can remove this model from our uncorrected light curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">uncorrected_lc</span> <span class="o">-</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original light curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected light curve&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9860ad5e64ad12d6826103a53837311bb36b972d58be174066e92df552786086.png" src="../../../_images/9860ad5e64ad12d6826103a53837311bb36b972d58be174066e92df552786086.png" />
</div>
</div>
<p>This looks great. As a final test, let’s investigate how the light curve we obtained using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> compares against a light curve obtained using a more basic median background removal method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">regressors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bkg</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bkg</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">npix</span> <span class="o">=</span> <span class="n">aper</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">median_subtracted_lc</span> <span class="o">=</span> <span class="n">uncorrected_lc</span> <span class="o">-</span> <span class="n">npix</span> <span class="o">*</span> <span class="n">bkg</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">median_subtracted_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Median background subtraction&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RegressionCorrector&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/846473021d13f1dc4fd78557a7a58b496d809a862f0030f48ba7608d2bea6143.png" src="../../../_images/846473021d13f1dc4fd78557a7a58b496d809a862f0030f48ba7608d2bea6143.png" />
</div>
</div>
<p>Lastly, let’s show how you can do all of the above in a single cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make an aperture mask and an uncorrected light curve</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">create_threshold_mask</span><span class="p">()</span>
<span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">aper</span><span class="p">)</span>

<span class="c1"># Make a design matrix and pass it to a linear regression corrector</span>
<span class="n">dm</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">DesignMatrix</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="o">~</span><span class="n">aper</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;regressors&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">append_constant</span><span class="p">()</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">RegressionCorrector</span><span class="p">(</span><span class="n">uncorrected_lc</span><span class="p">)</span>
<span class="n">corrected_ffi_lc</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>

<span class="c1"># Optional: Remove the scattered light, allowing for the large offset from scattered light</span>
<span class="n">corrected_ffi_lc</span> <span class="o">=</span> <span class="n">uncorrected_lc</span> <span class="o">-</span> <span class="n">rc</span><span class="o">.</span><span class="n">model_lc</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">model_lc</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original light curve&#39;</span><span class="p">)</span>
<span class="n">corrected_ffi_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected light curve&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9860ad5e64ad12d6826103a53837311bb36b972d58be174066e92df552786086.png" src="../../../_images/9860ad5e64ad12d6826103a53837311bb36b972d58be174066e92df552786086.png" />
</div>
</div>
</section>
<section id="using-regressioncorrector-on-tess-two-minute-cadence-target-pixel-files">
<h2>5. Using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> on <em>TESS</em> Two-Minute Cadence Target Pixel Files<a class="headerlink" href="#using-regressioncorrector-on-tess-two-minute-cadence-target-pixel-files" title="Permalink to this heading">#</a></h2>
<p><em>TESS</em> releases high-time resolution TPFs of interesting targets. These higher time resolution TPFs have background removed for users by the pipeline. However, there are still common trends in TPF pixels that are not due to scattered light, but could be from, for example, spacecraft motion.</p>
<p><code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> can be used in exactly the same way to remove these common trends.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download a 2-minute cadence Target Pixel File (TPF)</span>
<span class="n">tpf_2min</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">&#39;TESS&#39;</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">HTTPError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Download a 2-minute cadence Target Pixel File (TPF)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">tpf_2min</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">&#39;TESS&#39;</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/memoization/caching/plain_cache.py:42,</span> in <span class="ni">get_caching_wrapper.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="n">misses</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">---&gt; </span><span class="mi">42</span> <span class="n">result</span> <span class="o">=</span> <span class="n">user_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values_toolkit</span><span class="o">.</span><span class="n">make_cache_value</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ttl</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="n">key_argument_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/search.py:687,</span> in <span class="ni">search_targetpixelfile</span><span class="nt">(target, radius, exptime, cadence, mission, author, quarter, month, campaign, sector, limit)</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Search the `MAST data archive &lt;https://archive.stsci.edu&gt;`_ for target pixel files.</span>
<span class="g g-Whitespace">    </span><span class="mi">598</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">599</span><span class="sd"> This function fetches a data table that lists the Target Pixel Files (TPFs)</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">684</span><span class="sd">     &gt;&gt;&gt; search_targetpixelfile(&#39;Kepler-10&#39;, radius=100, quarter=4).download_all()  # doctest: +SKIP</span>
<span class="g g-Whitespace">    </span><span class="mi">685</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">686</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">687</span>     <span class="k">return</span> <span class="n">_search_products</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">688</span>         <span class="n">target</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span>         <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span>         <span class="n">filetype</span><span class="o">=</span><span class="s2">&quot;Target Pixel&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span>         <span class="n">exptime</span><span class="o">=</span><span class="n">exptime</span> <span class="ow">or</span> <span class="n">cadence</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>         <span class="n">mission</span><span class="o">=</span><span class="n">mission</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span>         <span class="n">provenance_name</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span>         <span class="n">quarter</span><span class="o">=</span><span class="n">quarter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">695</span>         <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">696</span>         <span class="n">campaign</span><span class="o">=</span><span class="n">campaign</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">697</span>         <span class="n">sector</span><span class="o">=</span><span class="n">sector</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">698</span>         <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">699</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span> <span class="k">except</span> <span class="n">SearchError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">701</span>     <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/search.py:995,</span> in <span class="ni">_search_products</span><span class="nt">(target, radius, filetype, mission, provenance_name, exptime, quarter, month, campaign, sector, limit, **extra_query_criteria)</span>
<span class="g g-Whitespace">    </span><span class="mi">992</span> <span class="k">if</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;ffi&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">993</span>     <span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="ne">--&gt; </span><span class="mi">995</span>     <span class="n">products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">996</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">997</span>         <span class="n">observations</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">998</span>         <span class="n">products</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1002</span>         <span class="n">table_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_products&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1004</span>     <span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;obs_id&quot;</span><span class="p">])</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/utils/class_or_instance.py:25,</span> in <span class="ni">class_or_instance.__get__.&lt;locals&gt;.f</span><span class="nt">(*args, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">25</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/utils/process_asyncs.py:26,</span> in <span class="ni">async_to_sync.&lt;locals&gt;.create_method.&lt;locals&gt;.newmethod</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="nd">@class_or_instance</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="k">def</span> <span class="nf">newmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">26</span>     <span class="n">response</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">async_method_name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>     <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;get_query_payload&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field_help&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>         <span class="k">return</span> <span class="n">response</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/utils/class_or_instance.py:25,</span> in <span class="ni">class_or_instance.__get__.&lt;locals&gt;.f</span><span class="nt">(*args, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">25</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/mast/observations.py:444,</span> in <span class="ni">ObservationsClass.get_product_list_async</span><span class="nt">(self, observations)</span>
<span class="g g-Whitespace">    </span><span class="mi">441</span> <span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_caom_products</span>
<span class="g g-Whitespace">    </span><span class="mi">442</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obsid&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">observations</span><span class="p">)}</span>
<span class="ne">--&gt; </span><span class="mi">444</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_portal_api_connection</span><span class="o">.</span><span class="n">service_request_async</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/utils/class_or_instance.py:25,</span> in <span class="ni">class_or_instance.__get__.&lt;locals&gt;.f</span><span class="nt">(*args, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">25</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/mast/discovery_portal.py:336,</span> in <span class="ni">PortalAPI.service_request_async</span><span class="nt">(self, service, params, pagesize, page, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">334</span> <span class="k">if</span> <span class="n">service</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_configs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">335</span>     <span class="n">fetch_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fetch_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">336</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_get_col_config</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">fetch_name</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">337</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_service</span> <span class="o">=</span> <span class="n">service</span>
<span class="g g-Whitespace">    </span><span class="mi">339</span> <span class="c1"># setting up pagination</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/mast/discovery_portal.py:233,</span> in <span class="ni">PortalAPI._get_col_config</span><span class="nt">(self, service, fetch_name)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>     <span class="n">fetch_name</span> <span class="o">=</span> <span class="n">service</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span>            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">}</span>
<span class="ne">--&gt; </span><span class="mi">233</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLUMNS_CONFIG_URL</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span>                          <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;colConfigId=&quot;</span><span class="o">+</span><span class="n">fetch_name</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_configs</span><span class="p">[</span><span class="n">service</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span> <span class="n">more</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># for some catalogs this is not enough information</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/astroquery/mast/discovery_portal.py:189,</span> in <span class="ni">PortalAPI._request</span><span class="nt">(self, method, url, params, data, headers, files, stream, auth, retrieve_all)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="s2">&quot;Timeout limit of </span><span class="si">{}</span><span class="s2"> exceeded.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> <span class="c1"># Raising error based on HTTP status if necessary</span>
<span class="ne">--&gt; </span><span class="mi">189</span> <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span> <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>  <span class="c1"># kind of hacky, but col_config service returns nothing if there is an error</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/requests/models.py:1021,</span> in <span class="ni">Response.raise_for_status</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1016</span>     <span class="n">http_error_msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1017</span>         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> Server Error: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2"> for url: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1018</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1020</span> <span class="k">if</span> <span class="n">http_error_msg</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1021</span>     <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="n">http_error_msg</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

<span class="ne">HTTPError</span>: 503 Server Error: Service Unavailable for url: https://mast.stsci.edu/portal/Mashup/Mashup.asmx/columnsconfig
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf_2min</span>
</pre></div>
</div>
</div>
</div>
<p>Note, unlike the FFI data, the TPF has been processed by the pipeline, and includes an aperture mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the pipeline aperture and an uncorrected light curve</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">tpf_2min</span><span class="o">.</span><span class="n">pipeline_mask</span>
<span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf_2min</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">()</span>

<span class="c1"># Make a design matrix</span>
<span class="n">dm</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">DesignMatrix</span><span class="p">(</span><span class="n">tpf_2min</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="o">~</span><span class="n">aper</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pixels&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">append_constant</span><span class="p">()</span>

<span class="c1"># Regression Corrector Object</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">RegressionCorrector</span><span class="p">(</span><span class="n">uncorrected_lc</span><span class="p">)</span>
<span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original light curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected light curve&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>As you can see, the corrected light curve has removed long-term trends and some motion noise, for example, see time around 1720 Barycentric <em>TESS</em> Julian Date (BTJD). We can use the same <code class="docutils literal notranslate"><span class="pre">diagnose()</span></code> method to understand the model that has been fit and subtracted by <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>To show the corrected version has improved, we can use the Combined Differential Photometric Precision (CDPP) metric. As shown below, the corrected light curve has a lower CDPP, showing it is less noisy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="should-i-use-regressioncorrector-or-pldcorrector">
<h2>6. Should I use <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> or <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>?<a class="headerlink" href="#should-i-use-regressioncorrector-or-pldcorrector" title="Permalink to this heading">#</a></h2>
<p>In addition to the corrector demonstrated in this tutorial, Lightkurve has a special case of <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> called <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>. PLD, or Pixel Level Decorrelation, is a method of removing systematic noise from light curves using linear regression, with a design matrix constructed from a combination of pixel-level light curves.</p>
<p>For more information about the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>, please see the tutorial specifically on removing instrumental noise from <em>K2</em> and <em>TESS</em> light curves using PLD.</p>
<p>For <em>TESS</em>, the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> works in a very similar way to the <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>. The major difference between them is that <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> constructs its own design matrix, making it a streamlined, versatile tool to apply to any <em>TESS</em> or <em>K2</em> light curve.</p>
<p>Here, we perform PLD and diagnose the correction in just three lines. To make a more direct comparison to the <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>, we pass in arguments to set the number of components to five (as in section 2), as well as remove the spline fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">PLDCorrector</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>
<span class="n">pld_corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">restore_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pca_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>And there we go!</p>
<p>Now let’s compare the performance of these two corrections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">corrected_ffi_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;RegressionCorrector&#39;</span><span class="p">)</span>
<span class="n">pld_corrected_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;PLDCorrector&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> offers an additional diagnostic plot, named <code class="docutils literal notranslate"><span class="pre">diagnose_masks</span></code>. This allows you to inspect the pixels that were used to create your design matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose_masks</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>While it is more convenient to apply to light curves and generally works well with default parameters, the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> is less flexible than the <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>, which allows you to create your own custom design matrix. However, the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> also allows you to create “higher order” PLD regressors by taking the products of existing pixel regressors, which improves the performance of corrections to <em>K2</em> data (see the paper by <a class="reference external" href="https://arxiv.org/abs/1607.00524">Luger et al. 2016</a> for more information).</p>
<p>When considering which corrector to use, remember that <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> is minimal and designed to be effective at removing both background scattered light from <em>TESS</em> and motion noise from <em>K2</em>, while <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> is flexible and gives you more control over the creation of the design matrix and the correction.</p>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Authors:</strong> Christina Hedges (christinalouisehedges&#64;gmail.com), Nicholas Saunders (nksaun&#64;hawaii.edu), Geert Barentsen</p>
<p><strong>Updated On:</strong> 2020-09-28</p>
</section>
</section>
<section id="citing-lightkurve-and-its-dependencies">
<h1>Citing Lightkurve and its Dependencies<a class="headerlink" href="#citing-lightkurve-and-its-dependencies" title="Permalink to this heading">#</a></h1>
<p>If you use <code class="docutils literal notranslate"><span class="pre">lightkurve</span></code> or its dependencies for published research, please cite the authors. Click the buttons below to copy BibTeX entries to your clipboard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lk</span><span class="o">.</span><span class="n">show_citation_instructions</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/TESS/removing_scattered_light_using_regression"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../interm_tess_prf_retrieve/interm_tess_prf_retrieve.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Intermediate: Retrieve TESS Pixel Response Function Images</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Removing Scattered Light from <em>TESS</em> Data Using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-regressioncorrector-on-tesscut-ffi-cutouts">1. Using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> on TESSCut FFI Cutouts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-designmatrix-from-pixel-regressors">2. Creating a <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> from Pixel Regressors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-background-scattered-light-using-linear-regression">3. Removing Background Scattered Light Using Linear Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnosing-the-correction">4. Diagnosing the Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-regressioncorrector-on-tess-two-minute-cadence-target-pixel-files">5. Using <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> on <em>TESS</em> Two-Minute Cadence Target Pixel Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#should-i-use-regressioncorrector-or-pldcorrector">6. Should I use <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> or <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-lightkurve-and-its-dependencies">Citing Lightkurve and its Dependencies</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>