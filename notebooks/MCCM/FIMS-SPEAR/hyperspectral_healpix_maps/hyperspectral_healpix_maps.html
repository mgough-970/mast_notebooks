

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Working with FIMS-SPEAR Hyperspectral HEALPix Maps &#8212; MAST Notebook Repository</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/hyperspectral_healpix_maps';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="MAST Table Access Protocol PanSTARRS 1 DR2 Demo" href="../../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html" />
    <link rel="prev" title="Removing Instrumental Noise from K2 and TESS Light Curves Using Pixel Level Decorrelation (PLD)" href="../../../K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/mastlogo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../../_static/mastlogo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Welcome to the MAST Notebook Repository!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Astrocut</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../astrocut/making_tess_cubes_and_cutouts/making_tess_cubes_and_cutouts.html">Generating Cubes and Cutouts from TESS FFIs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Astroquery</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../astroquery/intro.html">Intro</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../astroquery/nb.html">Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../astroquery/beginner_search/beginner_search.html">Beginner: Searching MAST using astroquery.mast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../astroquery/beginner_zcut/beginner_zcut.html">Beginner: Zcut and Astroquery Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../astroquery/large_downloads/large_downloads.html">Large Downloads in <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../astroquery/historic_quasar_observations/historic_quasar_observations.html">Historical Quasar Observations</a></li>





</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HSC</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../HSC/HCV_API/HCV_API_demo.html">Hubble Catalog of Variables Notebook (API version)</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../../HSC/HSCV3_API/hscv3_api.html">Hubble Source Catalog API Notebook</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../../HSC/HSCV3_SMC_API/hscv3_smc_api.html">Hubble Source Catalog API Notebook: SMC Color-Magnitude Diagram</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../../HSC/HSC_TAP/HSC_TAP.html">MAST Table Access Protocol Hubble Source Catalog Demo</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../../HSC/SWEEPS_HSCV3P1/sweeps_hscv3p1.html">Hubble Source Catalog SWEEPS Proper Motion Notebook</a></li>






















</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">IUE</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../IUE/exploring_UV_extinction_curves/exploring_UV_extinction_curves.html">Exploring UV Extinction Curves</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JWST</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../JWST/download_by_program_id/download_by_program_id.html">Accessing JWST Proposal Data in astroquery.mast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../JWST/Engineering_Database_Retreival/EDB_Retrieval.html">JWST Engineering Data Retrieval</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../../JWST/SI_keyword_exoplanet_search/SI_keyword_exoplanet_search.html">JWST SI Keyword Search for Exoplanet Spectra</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kepler</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../Kepler/beginner.html">Beginner Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/plotting_lightcurves/plotting_lightcurves.html">Using Kepler Data to Plot a Light Curve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/plotting_images_from_tpf/plotting_images_from_tpf.html">Plotting Images from Kepler Target Pixel Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/plotting_dvts/plotting_dvts.html">Read and Plot A Kepler Data Validation Timeseries File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/plotting_catalog_over_FFI/plotting_catalog_over_FFI.html">Plotting a Catalog over a Kepler Full Frame Image File</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../Kepler/lightkurve.html">Lightkurve</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/lightkurve_searching_for_data/lightkurve_searching_for_data.html">Searching for <em>Kepler</em>/<em>K2</em> and <em>TESS</em> Data Products Using Lightkurve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/lightkurve_custom_aperture_photometry/lightkurve_custom_aperture_photometry.html">Creating Your Own Light Curves using Custom Aperture Photometry</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/lightkurve_combining_multiple_quarters/lightkurve_combining_multiple_quarters.html">Combining Multiple Quarters of <em>Kepler</em> Data with Lightkurve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/lightkurve_interactively_inspecting_TPFs_and_LCs/lightkurve_interactively_inspecting_TPFs_and_LCs.html">Interactively Inspecting Target Pixel Files and Light Curves</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../Kepler/inst_noise.html">Instrumental Noise</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/instrumental_noise_1_data_gaps_and_quality_flags/instrumental_noise_1_data_gaps_and_quality_flags.html">Data Gaps and Quality Flags</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/instrumental_noise_2_spurious_signals_and_time_sampling_effects/instrumental_noise_2_spurious_signals_and_time_sampling_effects.html">Spurious Signals and Time Sampling Effects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/instrumental_noise_3_seasonal_and_detector_effects/instrumental_noise_3_seasonal_and_detector_effects.html">Seasonal and Detector Effects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/instrumental_noise_4_electronic_noise/instrumental_noise_4_electronic_noise.html">Electronic Noise</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../Kepler/signals.html">Identifying Periodic Signals</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/identifying_transiting_planet_signals/identifying_transiting_planet_signals.html">Identifying Transiting Planet Signals in a <em>Kepler</em> Light Curve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/measuring_a_rotation_period/measuring_a_rotation_period.html">Measuring and Removing a Rotation Period Signal from a <em>Kepler</em> Light Curve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/visualizing_periodic_signals_using_a_river_plot/visualizing_periodic_signals_using_a_river_plot.html">Visualizing Periodic Signals Using a River Plot</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/verifying_the_location_of_a_signal/verifying_the_location_of_a_signal.html">Verifying the Location of a Signal in <em>Kepler</em> Pixel Data</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../Kepler/periodograms.html">Periodograms &amp; Asteroseismology</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/creating_periodograms/creating_periodograms.html">Creating Periodograms</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star/how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star.html">How to Understand and Manipulate the Periodogram of an Oscillating Star</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../Kepler/how_to_estimate_a_stars_mass_and_radius_using_asteroseismology/how_to_estimate_a_stars_mass_and_radius_using_asteroseismology.html">How to Estimate a Star’s Mass and Radius Using Asteroseismology</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">K2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../K2/TPF/TPF.html">Beginner: Read and Display A K2 Target Pixel File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../K2/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">Beginner: Read and Display a K2 Full Frame Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.html">Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MCCM</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Working with FIMS-SPEAR Hyperspectral HEALPix Maps</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PanSTARRS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html">MAST Table Access Protocol PanSTARRS 1 DR2 Demo</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TESS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../TESS/beginner.html">Beginner Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_astroquery_dv/beginner_astroquery_dv.html">Retrieve TESS Data Validation Products with Astroquery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_how_to_use_dvt/beginner_how_to_use_dvt.html">Read and Plot A TESS Data Validation Timeseries File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">Read and Display a TESS Full Frame Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_how_to_use_lc/beginner_how_to_use_lc.html">Read and Plot A TESS Light Curve File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_how_to_use_tp/beginner_how_to_use_tp.html">Read and Display A TESS Target Pixel File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_tess_exomast/beginner_tess_exomast.html">Exoplanet Data and TESS Light Curves Using Python Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_tess_tap_search/beginner_tess_tap_search.html">Download MAST TESS Light Curves Within an FFI Footprint Using TAP</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_tic_search_hd209458/beginner_tic_search_hd209458.html">Search The TESS Input Catalog Centered On HD 209458.</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_tour_lc_tp/beginner_tour_lc_tp.html">A Tour of the Contents of the TESS 2-minute Cadence Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/beginner_tesscut_astroquery/beginner_tesscut_astroquery.html">Cutout of the TESS FFIs using Astrocut and Astroquery</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../TESS/lc.html">Light Curves</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/interm_gi_query/interm_gi_query.html">Intermediate:  Search and Download GI Program Light Curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/interm_tasoc_lc/interm_tasoc_lc.html">Intermediate: Finding Flares and Variable Stars in TASOC Light Curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/asteroid_rotation/asteroid_rotation.html">Finding the Rotation Curve of an Asteroid or Comet with TESScut and Lightkurve</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../TESS/FFIs.html">TESS FFIs</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/interm_tesscut_dss_overlay/interm_tesscut_dss_overlay.html">Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/interm_tesscut_requests/interm_tesscut_requests.html">Intermediate: Create TESS FFI Cutout using Python Requests</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../TESS/noise.html">Instrumental Noise</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/interm_tess_prf_retrieve/interm_tess_prf_retrieve.html">Intermediate: Retrieve TESS Pixel Response Function Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression.html">Removing Scattered Light from <em>TESS</em> Data Using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code></a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/spacetelescope/mast_notebooks/main?urlpath=tree/notebooks/notebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/hyperspectral_healpix_maps.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/mast_notebooks/blob/main/notebooks/notebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/hyperspectral_healpix_maps.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/mast_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/mast_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/hyperspectral_healpix_maps.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/notebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/hyperspectral_healpix_maps.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Working with FIMS-SPEAR Hyperspectral HEALPix Maps</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial">Tutorial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-wrangle-the-data">1. Download and wrangle the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#all-sky-maps-and-spectra">2. All-sky maps and spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slicing-and-rotating-comparing-fims-vs-spear-data">3. Slicing and rotating (Comparing FIMS vs. SPEAR data)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cartesian-projections-and-spectrum-extraction-from-circles-vela-supernova-remnant">4. Cartesian projections and spectrum extraction from circles (Vela Supernova Remnant)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-extraction-from-polygons-aquila-rift">5. Spectral extraction from polygons (Aquila Rift)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><a id="top"></a></p>
<section id="working-with-fims-spear-hyperspectral-healpix-maps">
<h1>Working with FIMS-SPEAR Hyperspectral HEALPix Maps<a class="headerlink" href="#working-with-fims-spear-hyperspectral-healpix-maps" title="Permalink to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p><strong>In this tutorial, you will learn how to retrieve, extract, manipulate, and plot data from <a class="reference external" href="https://archive.stsci.edu/missions-and-data/fims-spear">FIMS-SPEAR</a>, a <a class="reference external" href="https://archive.stsci.edu/new-mission-partnerships-with-mast">MAST Community-Contributed Mission</a>.</strong> By the end of this tutorial, you will be able to plot hyperspectral HEALPix maps in various projections and extract spectra from spatial regions of interest.</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>Launched on 2003 September 27, FIMS-SPEAR conducted the first large-area spectral survey of the far-ultraviolet sky, a band which spans warm and hot plasma cooling lines, molecular hydrogen fluorescent emission, and dust-scattered starlight. The astronomical data and the <a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS">mission manual</a> are hosted by the Mikulski Archive for Space Telescopes (MAST).</p>
<p>The FIMS-SPEAR instrument comprised dual imaging spectrographs optimized for measuring diffuse emission, including the “Short” S-band (900–1150 Å) and the “Long” L-band (1350–1710 Å). The instrument was capable of spatial resolutions down to 5 arcmin, and a spectral resolving power around λ/Δλ=550 in both bands. Available data products include hyperspectral imaging covering most of the sky, extracted line emission maps, star spectra, and pointed observations of the Vela supernova remnant.</p>
<p><strong>This demo is primarily concerned with the hyperspectral imaging survey. The all-sky data were spatially binned using the HEALPix scheme</strong> (<a class="reference external" href="https://healpix.sourceforge.io/index.php">Hierarchical Equal Area isoLatitude Pixelation</a>). A couple key features include:</p>
<ol class="arabic simple">
<li><p>HEALPixelization subdivides the spherical surface of the sky into curvilinear quadrilaterals pixels, with each pixel’s surface area equal to that of every other pixel.</p></li>
<li><p>HEALPix maps parameterize the two spatial dimensions of sky coordinates as a one-dimensional array, following a pre-determined pixel ordering scheme.</p></li>
</ol>
<p><strong>FIMS-SPEAR hyperspectral HEALPix maps are highly unusual in that they also have a wavelength axis, with a spectrum for each HEALPixel.</strong> Standard HEALPix software like <a class="reference external" href="https://healpy.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">healpy</span></code></a> are not currently set up to handle hyperspectral data by default. In this tutorial, we will show how to make FIMS-SPEAR hyperspectral data tractable by <code class="docutils literal notranslate"><span class="pre">healpy</span></code>.</p>
<p>In this notebook, you will:</p>
<ol class="arabic simple">
<li><p>Load the hyperspectral HEALPix map data, wrangle them into a usable form, and learn about their FITS headers</p></li>
<li><p>Plot some all-sky maps and spectra</p></li>
<li><p>Trim the wavelength axis and use coordinate rotator functions to compare FIMS vs. SPEAR data products</p></li>
<li><p>Plot a cartesian projection of the Vela supernova remnant and extract its spectrum</p></li>
<li><p>Extract spectra from a variety of custom regions around the Aquila Rift</p></li>
</ol>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<p>This notebook uses the following packages:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">healpy</span></code> to handle HEALPix data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to handle array operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy</span></code> for working with FITS files, table data, and units</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">copy</span></code> for deep copy operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> for plotting data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">specutils</span></code> for smoothing spectra</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ipython.display</span></code> for displaying figure titles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code> and <code class="docutils literal notranslate"><span class="pre">os</span></code> for file downloads</p></li>
</ul>
<p>If you do not have these packages installed, you can install them using <a class="reference external" href="https://docs.conda.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">conda</span></code></a> or <a class="reference external" href="https://pip.pypa.io/en/stable/"><code class="docutils literal notranslate"><span class="pre">pip</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># healpy software for wrangling HEALPix maps</span>
<span class="kn">import</span> <span class="nn">healpy</span> <span class="k">as</span> <span class="nn">hp</span>

<span class="c1"># arrays</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># table operations to help with wrangling hyperspectral HEALPix maps</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.table.pprint</span> <span class="kn">import</span> <span class="n">conf</span>

<span class="c1"># FITS</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="c1"># deep copy operations</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>

<span class="c1"># spectrum smoothing</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">Spectrum1D</span>
<span class="kn">import</span> <span class="nn">specutils.manipulation</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>

<span class="c1"># downloads</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># healpy software for wrangling HEALPix maps</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">healpy</span> <span class="k">as</span> <span class="nn">hp</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># arrays</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;healpy&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fixing a few global settings</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.5</span><span class="p">,</span> <span class="mf">5.85</span><span class="p">)</span>
<span class="n">conf</span><span class="o">.</span><span class="n">max_lines</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># Max lines for astropy.Table in-notebook display</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">#</a></h2>
<section id="download-and-wrangle-the-data">
<h3>1. Download and wrangle the data<a class="headerlink" href="#download-and-wrangle-the-data" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">healpy</span></code> was designed to work with maps that describe how a measured quantity varies as a function of position on the sky. For example, we can read in the SPEAR team’s C IV integrated emission line map using the built-in function <code class="docutils literal notranslate"><span class="pre">healpy.fitsfunc.read_map</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the SPEAR C IV emission line map with adaptive binning</span>
<span class="n">uri0</span> <span class="o">=</span> <span class="s1">&#39;mast:MCCM/fims-spear/spear/hp-map/adaptive/mccm_fims-spear_spear-ap100-adaptive_sky-starless_long-c-iv_v1.0_hp-map.fits&#39;</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">uri0</span><span class="p">)</span> <span class="c1"># 15 MB</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 1: C IV map (adaptive binning)&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Read it in with read_map</span>
<span class="n">civ</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">fitsfunc</span><span class="o">.</span><span class="n">read_map</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_spear-ap100-adaptive_sky-starless_long-c-iv_v1.0_hp-map.fits&#39;</span><span class="p">)</span>

<span class="c1"># Plot it. This product is in Ecliptic coordinates, </span>
<span class="c1"># so we use coord=[&#39;E&#39;,&#39;G&#39;] to plot it in Galactic coordinates.</span>
<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">civ</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5e4</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;photon cm-2 s-1 sr-1&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 1 image description: all-sky map of integrated intensity from the C IV emission line, with adaptive binning that gets smaller in regions with high intensity (like the Vela supernova remnant towards the right, the brightest part of the map).</center></div></blockquote>
<p>But hyperspectral maps are a little bit more complicated, and <code class="docutils literal notranslate"><span class="pre">healpy.fitsfunc.read_map</span></code> won’t work for them.</p>
<p>Let’s download several hyperspectral HEALPix maps created by the FIMS team: Nside=64 for both bands, and an additional higher-Nside map for L-Band. The spatial resolution of a HEALPix scheme is parameterized as <code class="docutils literal notranslate"><span class="pre">Nside</span></code>, which is equal to the number of subdivisions along the side of a baseline HEALPixel (where the baseline HEALPixel at Nside=1 spans 1/12th of the sky).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uri1</span> <span class="o">=</span> <span class="s1">&#39;mast:MCCM/fims-spear/fims/hp-map-hsi/mccm_fims-spear_fims-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span>
<span class="n">uri2</span> <span class="o">=</span> <span class="s1">&#39;mast:MCCM/fims-spear/fims/hp-map-hsi/mccm_fims-spear_fims-ap100-n064_sky-starless_short_v1.0_hp-map-hsi.fits.gz&#39;</span>
<span class="n">uri3</span> <span class="o">=</span> <span class="s1">&#39;mast:MCCM/fims-spear/spear/hp-map-hsi/mccm_fims-spear_spear-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span>
<span class="n">uri4</span> <span class="o">=</span> <span class="s1">&#39;mast:MCCM/fims-spear/spear/hp-map-hsi/mccm_fims-spear_spear-ap100-n064_sky-starless_short_v1.0_hp-map-hsi.fits.gz&#39;</span>

<span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">uri1</span><span class="p">)</span> <span class="c1"># 110 MB</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">uri2</span><span class="p">)</span> <span class="c1"># 50 MB</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">uri3</span><span class="p">)</span> <span class="c1"># 50 MB</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">uri4</span><span class="p">)</span> <span class="c1"># 20 MB</span>
</pre></div>
</div>
</div>
</div>
<p>For our high-resolution map, it would be ideal to use the highest resolution available, Nside=512. But that would be 4.5 GB compressed on-disk, and 12 GB decompressed into memory. So for this demonstration we’ll default to a special Nside=256 map that only contains data in the regions that we need.</p>
<p><strong>If you have a good internet connection and sufficient RAM, we highly recommend that you comment out the first cell below, and uncomment the second cell, for the full FIMS-SPEAR experience. Everything in this notebook will work either way!</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this cell if you have a limited internet connection or limited RAM.</span>

<span class="n">nside_highres</span> <span class="o">=</span> <span class="mi">256</span> <span class="c1"># Download the Nside=256 map cutout</span>
<span class="n">uri5</span> <span class="o">=</span> <span class="s1">&#39;mast:MCCM/fims-spear/tutorial/mccm_fims-spear_fims-ap100-n256_tutorial-cutout-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span> <span class="c1"># tutorial cutout map</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Uncomment this cell to use the full Nside=512 map instead:</span>

<span class="c1"># nside_highres = 512 # Download the Nside=512 full map</span>
<span class="c1"># uri5 = &#39;mast:MCCM/fims-spear/fims/hp-map-hsi/mccm_fims-spear_fims-ap100-n512_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39; # full map</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute this cell either way:</span>

<span class="n">Observations</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">uri5</span><span class="p">)</span> <span class="c1"># 360 MB (or 4.5 GB if the second cell above is executed)</span>
<span class="n">file_highres</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">uri5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Before we delve into the details, let’s first demonstrate that it only takes two lines of code to load up a FIMS-SPEAR hyperspectral HEALPix map, integrate it over wavelength, and plot it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 2: Integrated intensity map&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Load the data with astropy.</span>
<span class="n">l_n064</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_fims-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">,</span> 
                    <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span> <span class="c1"># The &quot;.filled(np.NaN)&quot; is important; see &quot;a note about NaNs&quot; below.</span>

<span class="c1"># Integrate over wavelength and plot the data.</span>
<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5e6</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;photon cm-2 s-1 sr-1&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># Galactic coordinates</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 2 image description: all-sky map of integrated intensity. The Galactic plane is seen as regions of high intensity.</center></div></blockquote>
<p>Done! But it will help to understand why this worked and how the data is structured, so let’s take a look at the FITS header:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_fims-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">)</span>

<span class="n">hdul</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The file consists of a primary header data unit and a binary table extension. The primary only contains a header, reporting general information about the observations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
</pre></div>
</div>
</div>
</div>
<p>The data is in the extension. After some basic info, the BINTABLE extension’s header is divided into three parts.</p>
<ol class="arabic simple">
<li><p>Information from which you can construct the wavelength array. This section is not usually in a HEALPix header; FIMS-SPEAR is the first publically-archived data in which a hyperspectral map is being stored in a HEALPix arrangement!</p></li>
<li><p>Information about the HEALPixelization scheme. Note that the total number of HEALPixels (spatial bins) is equal to <code class="docutils literal notranslate"><span class="pre">12</span> <span class="pre">x</span> <span class="pre">NSIDE^2</span> <span class="pre">=</span> <span class="pre">NAXIS2</span> <span class="pre">=</span> <span class="pre">LASTPIX</span> <span class="pre">+</span> <span class="pre">1</span></code>. This will be true for all FIMS-SPEAR HEALPix maps.</p></li>
<li><p>Information about the “columns” of the binary table, including their structure and astronomical units. We’ll learn more about this table soon.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
</pre></div>
</div>
</div>
</div>
<p>Note that FIMS-SPEAR data follows the “RING” pixel ordering scheme (in which the pixel number winds down from the north to south pole through consecutive isolatitude rings), with “IMPLICIT” indexing (meaning that a value is provided for every pixel on the sky, even if that value is NaN).</p>
<p><strong>Important:</strong> Each HEALPixel contains a spectrum, and the current version of <code class="docutils literal notranslate"><span class="pre">healpy</span></code> can’t handle this addition of the wavelength axis without a little data wrangling. So we’ll start by reading in the binary tables with <code class="docutils literal notranslate"><span class="pre">astropy.Table</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">l_n064</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_fims-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">,</span> 
                    <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>

<span class="n">s_n064</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_fims-ap100-n064_sky-starless_short_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">,</span> 
                    <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>

<span class="n">l_highres</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_highres</span><span class="p">,</span> 
                    <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span> <span class="c1"># this one may take a minute</span>
</pre></div>
</div>
</div>
</div>
<p>(A note about NaNs: You might be wondering why we needed <code class="docutils literal notranslate"><span class="pre">.filled(np.NaN)</span></code>. There are regions of the sky without coverage by FIMS-SPEAR, which are represented as NaN values in the FITS binary table. By default, <code class="docutils literal notranslate"><span class="pre">astropy.Table</span></code> masks these pixels with the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> fill value for masking floats, 1e20. But the <code class="docutils literal notranslate"><span class="pre">healpy</span></code> fill value for masking bad data is -1.6375e+30. Plus, we’re sometimes going to need to sum arrays over the wavelength axis, and we don’t want to sum up either of these fill values. So, here we’re bypassing the problem entirely by using NaNs instead of masking fill values.)</p>
<p>Let’s take a look at the L-band, Nside=64 table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l_n064</span>
</pre></div>
</div>
</div>
</div>
<p>This table has 49152 rows, equal to the number of HEALPixels in the map (<code class="docutils literal notranslate"><span class="pre">12</span> <span class="pre">x</span> <span class="pre">Nside^2</span></code>). The columns and their units correspond to the <code class="docutils literal notranslate"><span class="pre">TTYPEi</span></code> and <code class="docutils literal notranslate"><span class="pre">TUNITi</span></code> keywords in the FITS extension header.</p>
<p>EXP-SLIT (<a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS/Exposure+Time+Calculation">the FIMS definition of exposure time</a>) is a simple HEALPix map, with one value per HEALPixel. But for the other columns, each HEALPixel contains an array of length 340, giving the value in each wavelength bin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>For our final piece of data wrangling, let’s create the wavelength arrays:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># S-band</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_fims-ap100-n064_sky-starless_short_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">crval</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRVAL1&#39;</span><span class="p">]</span>
    <span class="n">cdelt</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">swave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span><span class="o">*</span><span class="n">cdelt</span><span class="o">+</span><span class="n">crval</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;S-band: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">swave</span><span class="p">)</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">swave</span><span class="p">)</span><span class="si">}</span><span class="s1"> Angstrom, </span><span class="si">{</span><span class="n">bins</span><span class="si">}</span><span class="s1"> bins&#39;</span><span class="p">)</span>

<span class="c1"># L-band</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_fims-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">crval</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRVAL1&#39;</span><span class="p">]</span>
    <span class="n">cdelt</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lwave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span><span class="o">*</span><span class="n">cdelt</span><span class="o">+</span><span class="n">crval</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;L-band: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">lwave</span><span class="p">)</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">lwave</span><span class="p">)</span><span class="si">}</span><span class="s1"> Angstrom, </span><span class="si">{</span><span class="n">bins</span><span class="si">}</span><span class="s1"> bins&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="all-sky-maps-and-spectra">
<h3>2. All-sky maps and spectra<a class="headerlink" href="#all-sky-maps-and-spectra" title="Permalink to this heading">#</a></h3>
<p>First, we’ll make all-sky maps of total intensity integrated over wavelength:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Integrated intensity maps (background-subtracted)</span>
<span class="n">l_n064_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># integrate over wavelength</span>
<span class="n">s_n064_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">l_highres_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l_n064_map</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s_n064_map</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l_highres_map</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll make all-sky, spatially-averaged intensity spectra.</p>
<p>But first, a small detour: when extracting a spatially-averaged spectrum from some region of the sky, computing a simple average will in many cases lead to spiky artifacts in the averaged spectrum, due to low signal-to-noise in HEALPixels with extremely low exposure time. The effect is strongest at low Nside.</p>
<p>Instead, you should strongly consider weighting the intensity by exposure time, essentially giving up on a spatially uniform average in order to achieve improved signal-to-noise. That’s what we’ll do in this notebook.</p>
<p><em>Note: regardless of which method you use, if the exact shape of the extraction region is important to your science, you should pay close attention to the exposure map in your extraction region.</em></p>
<p><strong>Important:</strong> we need to use numpy.nansum, numpy.nanmean etc. when integrating over the spatial axis, to handle the HEALPixels without sky coverage. So let’s first define a NaN-compatible function to compute an exposure-weighted average spectrum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">weighted_spatial_average</span><span class="p">(</span><span class="n">inten</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">inten</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">exp</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

<span class="c1"># Inputs: hyperspectral intensity map (2D), exposure map (1D)</span>
<span class="c1"># Assumes the shape of inten is (HEALPixels, wavelengths)</span>
<span class="c1"># Returns sum(intensity*exposure)/sum(exposure)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we’ll use that function to compute exposure-weighted all-sky spectra:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Maps of spatially-averaged spectra</span>
<span class="n">l_n064_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">])</span> <span class="c1"># integrate over spatial coordinate</span>
<span class="n">s_n064_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">s_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">s_n064</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">])</span>
<span class="n">l_highres_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l_n064_spec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s_n064_spec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l_highres_spec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’re ready to use <code class="docutils literal notranslate"><span class="pre">healpy</span></code>, which is designed to plot HEALPix maps! Let’s start with the low-resolution, Nside=64 map, in which each HEALPixel is 55 arcmin in size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># healpy plot settings</span>
<span class="n">min1</span><span class="p">,</span> <span class="n">max1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3e6</span> <span class="c1"># intensity range for colorbar</span>
<span class="n">interval</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># healpy graticule spacing in degrees</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 3: Integrated intensity maps and all-sky spectra&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Setting up the figure</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="s2">&quot;AB;CD&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Plotting the spatial map</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_map</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;L-band, Nside=64 (photon cm-2 s-1 sr-1)&#39;</span><span class="p">,</span> 
            <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">notext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">s_n064_map</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">*</span><span class="mf">2.</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;S-band,  Nside=64 (photon cm-2 s-1 sr-1)&#39;</span><span class="p">,</span>
            <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">notext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">hp</span><span class="o">.</span><span class="n">graticule</span><span class="p">(</span><span class="n">dpar</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">dmer</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>


<span class="c1"># Plotting the spatially-averaged spectra</span>

<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave</span><span class="p">,</span> <span class="n">l_n064_spec</span><span class="p">)</span> <span class="c1"># L-band</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;photon cm-2 s-1 sr-1 Å-1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">lwave</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">lwave</span><span class="p">))</span>


<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">swave</span><span class="p">,</span> <span class="n">s_n064_spec</span><span class="p">)</span> <span class="c1"># S-band</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">swave</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">swave</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">2000.</span><span class="p">,</span> <span class="mf">14000.</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 3 image description: The top row shows all-sky integrated intensity in the L and S bands; the S-band data is much noisier. The bottom row shows the averaged all-sky spectrum, displaying many strong emission lines in both bands.</center></div></blockquote>
<p>Let’s also make count maps integrated over wavelength, and plot them alongside the exposure maps:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Integrated count maps</span>
<span class="n">l_n064_cmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;COUNT&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># integrate over wavelength</span>
<span class="n">s_n064_cmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_n064</span><span class="p">[</span><span class="s1">&#39;COUNT&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 4: Integrated count maps and exposure maps&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Setting up the figure</span>
<span class="n">margins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="s2">&quot;AB;CD&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Plotting the spatial map</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_cmap</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;L-band, Nside=64 (photon/pix)&#39;</span><span class="p">,</span> 
            <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">notext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="n">margins</span><span class="p">)</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">s_n064_cmap</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;S-band,  Nside=64 (photon/pix)&#39;</span><span class="p">,</span>
            <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">notext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="n">margins</span><span class="p">)</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">],</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;L-band, Nside=64 (s/slitwidth^2)&#39;</span><span class="p">,</span> 
            <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">notext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="n">margins</span><span class="p">)</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">s_n064</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">],</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;S-band,  Nside=64 (s/slitwidth^2)&#39;</span><span class="p">,</span>
            <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">notext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="n">margins</span><span class="p">)</span>

<span class="n">hp</span><span class="o">.</span><span class="n">graticule</span><span class="p">(</span><span class="n">dpar</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">dmer</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 4 image description: The top row shows all-sky integrated count maps in the L and S bands, and the bottom row shows exposure maps in the L and S bands. The count maps and the exposure maps look similar. </center></div></blockquote>
<p>Many fewer counts were detected in S-band compared to L-band, even though their exposure times were broadly similar. This is because <a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS/Design">the S-band detector suffered from a severe loss of sensitivity during manufacturing</a>.</p>
<p>Finally, let’s take a quick look at an Nside=512 map, in which each HEALPixel is about 7 arcmin in size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # If you downloaded the full 4.5 GB, Nside=512 map, uncomment this cell and plot it yourself:</span>

<span class="c1"># display(Markdown(&quot;&lt;font size=6&gt;Fig. 5: High-resolution integrated intensity map&lt;/font&gt;&quot;))</span>
<span class="c1"># hp.mollview(l_highres_map, min=min1, max=max1, coord=&#39;G&#39;, unit=&#39;photon cm-2 s-1 sr-1&#39;, title=&#39;&#39;, notext=True)</span>
</pre></div>
</div>
</div>
</div>
<p><font size=6>Fig. 5: High-resolution integrated intensity map</font>
<img alt="highres_map.png" src="notebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps/attachment:highres_map.png" /></p>
<blockquote>
<div><center>Fig. 5 image description: The Nside=512 integrated intensity all-sky map is chaotically sprinkled with many small dots of high and low intensity.</center></div></blockquote>
<p>It’s noisier, but as we’ll see in Sections 4 and 5, still very useful!</p>
</section>
<section id="slicing-and-rotating-comparing-fims-vs-spear-data">
<h3>3. Slicing and rotating (Comparing FIMS vs. SPEAR data)<a class="headerlink" href="#slicing-and-rotating-comparing-fims-vs-spear-data" title="Permalink to this heading">#</a></h3>
<p>Until now, we’ve focused on data products created by the FIMS team. The FIMS-SPEAR mission products at MAST include products produced by the FIMS team’s pipeline and by the SPEAR team’s pipeline, with <a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS/FIMS+vs.+SPEAR+Features">a variety of complex differences between the two</a>.</p>
<p>In this section, let’s compare the FIMS and SPEAR data by dividing or subtracting their integrated intensity maps. To do that, we’ll first have to slice off some vignetted edges in the SPEAR team’s data, and rotate the coordinate systems to match each other.</p>
<p>Let’s load up the SPEAR team’s data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the data</span>
<span class="n">l_n064_spear</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_spear-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">,</span> 
                          <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">s_n064_spear</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_spear-ap100-n064_sky-starless_short_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">,</span> 
                          <span class="n">hdu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the SPEAR wavelength arrays</span>
<span class="c1"># (same procedure as before, condensed into fewer lines at the expense of readability)</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_spear-ap100-n064_sky-starless_short_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">swave_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRVAL1&#39;</span><span class="p">]</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mccm_fims-spear_spear-ap100-n064_sky-starless_long_v1.0_hp-map-hsi.fits.gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
    <span class="n">lwave_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRVAL1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>First, notice that the SPEAR data has some severe vignetting at the edges of the bandpasses, which in the FIMS data had just been trimmed off:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 6: SPEAR all-sky spectra&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Make all-sky spectra</span>
<span class="n">l_n064_spear_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;EXP-PIX&#39;</span><span class="p">])</span> <span class="c1"># integrate over spatial coordinate</span>
<span class="n">s_n064_spear_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">s_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">],</span> <span class="n">s_n064_spear</span><span class="p">[</span><span class="s1">&#39;EXP-PIX&#39;</span><span class="p">])</span>

<span class="c1"># Plot the all-sky spectra</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="s2">&quot;A;B&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave_spear</span><span class="p">,</span> <span class="n">l_n064_spear_spec</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">swave_spear</span><span class="p">,</span> <span class="n">s_n064_spear_spec</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 6 image description: The SPEAR average all-sky spectra look similar to their FIMS equivalents in the bottom row of Fig. 3, but at the high and low wavelength edges of both bands, they abruptly peak and/or dip due to instrumental effects.</center></div></blockquote>
<p>Let’s trim the SPEAR intensity array to approximately match the wavelength range of the FIMS data, and try that again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Conditional array, True for indices of lwave_spear where the SPEAR wavelength is in the FIMS wavelength range.</span>
<span class="c1"># The vignetting in SPEAR data actually encroaches a bit further than in FIMS, so we&#39;ll trim an extra 20 A off.</span>
<span class="n">condition_lwave</span> <span class="o">=</span> <span class="p">(</span><span class="n">lwave_spear</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">lwave</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lwave_spear</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">lwave</span><span class="p">)</span><span class="o">-</span><span class="mf">20.</span><span class="p">)</span>
<span class="n">condition_swave</span> <span class="o">=</span> <span class="p">(</span><span class="n">swave_spear</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">swave</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">swave_spear</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">swave</span><span class="p">)</span><span class="o">-</span><span class="mf">20.</span><span class="p">)</span>


<span class="c1"># For example, here&#39;s the SPEAR L-band intensity array trimmed to this approximation of the FIMS wavelength range:</span>
<span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][:,</span> <span class="n">condition_lwave</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make trimmed all-sky spectrum</span>
<span class="n">l_n064_spear_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][:,</span> <span class="n">condition_lwave</span><span class="p">],</span> <span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;EXP-PIX&#39;</span><span class="p">])</span> <span class="c1"># integrate over spatial coordinate</span>
<span class="n">s_n064_spear_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">s_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][:,</span> <span class="n">condition_swave</span><span class="p">],</span> <span class="n">s_n064_spear</span><span class="p">[</span><span class="s1">&#39;EXP-PIX&#39;</span><span class="p">])</span>

<span class="c1"># Plot the trimmed all-sky spectra</span>

<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 7: SPEAR all-sky spectra (trimmed)&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="s2">&quot;A;B&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave_spear</span><span class="p">[</span><span class="n">condition_lwave</span><span class="p">],</span> <span class="n">l_n064_spear_spec</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">swave_spear</span><span class="p">[</span><span class="n">condition_swave</span><span class="p">],</span> <span class="n">s_n064_spear_spec</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 7 image description: The SPEAR average all-sky spectra with the vignetted edges trimmed off, now looking very similar to their FIMS equivalents in the bottom row of Fig. 3.</center></div></blockquote>
<p>Let’s adopt this wavelength trim and plot the integrated intensity maps for SPEAR:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Integrated intensity maps (background-subtracted, with wavelengths trimmed)</span>
<span class="n">l_n064_spear_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][:,</span> <span class="n">condition_lwave</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># sum trimmed map over wavelength</span>
<span class="n">s_n064_spear_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_n064_spear</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][:,</span> <span class="n">condition_swave</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And plot the L-band map we just made:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 8: SPEAR integrated intensity map&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_spear_map</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5e6</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># SPEAR products are in Ecliptic coordinates</span>
<span class="n">hp</span><span class="o">.</span><span class="n">graticule</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 8 image description: The SPEAR integrated intensity all-sky map in ecliptic coordinates.</center></div></blockquote>
<p>It’s clear from this plot that we should be cautious about data artifacts near the edges of the observed footprint. This is true for both SPEAR and FIMS data.</p>
<p>Let’s take a closer look. SPEAR data are in Ecliptic coordinates, but we can rotate SPEAR data to Galactic coordinates in the plotting program:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 9: SPEAR map plotted in Galactic coordinates&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Rotate from Ecliptic to Galactic coordinates</span>
<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_spear_map</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5e6</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">hp</span><span class="o">.</span><span class="n">graticule</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 9 image description: The SPEAR integrated intensity all-sky map plotted in Galactic coordinates.</center></div></blockquote>
<p>The footprint differs between the FIMS and SPEAR products, but there is a lot of overlap.</p>
<p>It would be interesting to divide FIMS map by the SPEAR map, to see how the processing differences manifest in the ratio of the final products’ intensity maps. But one of the more obvious differences between the FIMS and SPEAR products is that FIMS maps are in Galactic coordinates while SPEAR maps are in Ecliptic coordinates, and the rotation function in <code class="docutils literal notranslate"><span class="pre">mollview</span></code> can’t help us divide the two maps.</p>
<p>So to rotate the HEALPix scheme itself, instead of just plotting the rotation, we can use the <code class="docutils literal notranslate"><span class="pre">healpy.Rotator</span></code> and <code class="docutils literal notranslate"><span class="pre">healpy.rotate_map_pixel</span></code> functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rot_custom</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">Rotator</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">])</span> <span class="c1"># define a function to rotate from Ecliptic to Galactic coordinates</span>
<span class="n">l_n064_spear_map_galactic</span> <span class="o">=</span> <span class="n">rot_custom</span><span class="o">.</span><span class="n">rotate_map_pixel</span><span class="p">(</span><span class="n">l_n064_spear_map</span><span class="p">)</span>
<span class="n">s_n064_spear_map_galactic</span> <span class="o">=</span> <span class="n">rot_custom</span><span class="o">.</span><span class="n">rotate_map_pixel</span><span class="p">(</span><span class="n">s_n064_spear_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 10: SPEAR map rotated to Galactic coordinates&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_spear_map_galactic</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5e6</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">hp</span><span class="o">.</span><span class="n">graticule</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 10 image description: The SPEAR integrated intensity all-sky map rotated to Galactic coordinates, then plotted. Noticeably blurry, now that the data itself has been rotated.</center></div></blockquote>
<p><strong>Important: Rotate with caution!</strong> Notice that the above map is a little blurrier than it was before. There is not a 1:1 relationship between HEALPixels in the original map and HEALPixels in the rotated map; the rotation functions interpolate between the HEALPixels to make new HEALPixels, which has a smoothing effect. This is why we don’t pre-rotate the products to match each other.</p>
<p>If you must rotate, it would be <em>better</em> to rotate the highest-resolution data you have, then re-bin (using <code class="docutils literal notranslate"><span class="pre">healpy.pixelfunc.ud_grade</span></code>, looping through all the wavelength slices) to make lower-resolution maps as desired.</p>
<p>But for now, for simplicity’s sake, let’s proceed to divide this rotated SPEAR map by the FIMS map:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 11: Rotated SPEAR map divided by FIMS map&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_spear_map_galactic</span><span class="o">/</span><span class="n">l_n064_map</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">hp</span><span class="o">.</span><span class="n">graticule</span><span class="p">()</span>

<span class="c1"># The output value is NaN in places where the footprints don&#39;t overlap.</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 11 image description: The ratio of the SPEAR integrated intensity map (rotated to Galactic coordinates) divided by the FIMS integrated intensity map. The ratio is close to 1 in most regions, but the image is complex, with deviations out to near 0 and greater than 2 in scattered patches.</center></div></blockquote>
<p>The ratio is about 1 across most of the sky, but there are substantial differences in some scan regions and in a variety of emission features. Some of the differences may be attributable to the difference in star removal procedures. These procedures were conducted at a higher resolution than the maps we’re plotting here—so rather than seeing the holes where stars were removed, the removal of stars has the subtle effect of changing the intensity in each pixel.</p>
<p>See the <a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS/">FIMS-SPEAR manual</a> for a <a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS/FIMS+vs.+SPEAR+Features">summary</a> of the high-level differences between the FIMS and SPEAR data processing pipelines.</p>
<p>Note that a more careful comparison of the FIMS and SPEAR maps would have ensured that the wavelength ranges over which we integrated were exactly equal (here, we fudged the input by 20 Angstroms). A better analysis would also have been more careful to avoid interpolative smoothing by the coordinate rotation, which could be accomplished by rotating an Nside=512 FIMS map to Ecliptic coordinates, downsampling the resolution to Nside=64 using <code class="docutils literal notranslate"><span class="pre">healpy.pixelfunc.ud_grade</span></code>, and then dividing the maps in Ecliptic coordinates. We leave this as an exercise to the reader.</p>
</section>
<section id="cartesian-projections-and-spectrum-extraction-from-circles-vela-supernova-remnant">
<h3>4. Cartesian projections and spectrum extraction from circles (Vela Supernova Remnant)<a class="headerlink" href="#cartesian-projections-and-spectrum-extraction-from-circles-vela-supernova-remnant" title="Permalink to this heading">#</a></h3>
<p>Let’s take a look at the Vela supernova remnant. We can use <code class="docutils literal notranslate"><span class="pre">healpy.cartview</span></code> to plot a cutout of the sky in a Cartesian projection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 12: Vela supernova remnant&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="n">lonrange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">]</span> <span class="c1"># Range of Galactic longitude</span>
<span class="n">latrange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="c1"># Range of Galactic latitude</span>
<span class="n">hp</span><span class="o">.</span><span class="n">cartview</span><span class="p">(</span><span class="n">l_n064_map</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">*</span><span class="mf">3.</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">lonra</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span> <span class="n">latra</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vela&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 12 image description: Cartesian projection of the region around the Vela supernova remnant in the FIMS integrated intensity map. The image is low-resolution.</center></div></blockquote>
<p>So blurry! Let’s put our glasses on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 13: Vela supernova remnant&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Switching to the higher resolution map</span>
<span class="n">hp</span><span class="o">.</span><span class="n">cartview</span><span class="p">(</span><span class="n">l_highres_map</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">*</span><span class="mf">3.</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">lonra</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span> <span class="n">latra</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vela&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 13 image description: Cartesian projection of the region around the Vela supernova remnant in the FIMS integrated intensity map. The image is high-resolution.</center></div></blockquote>
<p>Much better. Note the holes that were produced by the star removal algorithm, inside which are NaN values.</p>
<p>Next, let’s extract the spectrum of the Vela supernova remnant environs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the center of the circular extraction region</span>
<span class="n">ra1</span> <span class="o">=</span> <span class="mf">263.55197071</span> <span class="c1"># Galactic longitude (deg)</span>
<span class="n">dec1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">02.78725587</span> <span class="c1"># Galactic latitude (deg)</span>
<span class="n">rad1</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># 5 deg radius</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">ang2vec</span><span class="p">(</span><span class="n">ra1</span><span class="p">,</span> <span class="n">dec1</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">inclusive</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># For extracting regions, include all pixels that overlap with the cone (True), or only those whose centers lie in the cone (False).</span>
    
<span class="n">fact</span> <span class="o">=</span> <span class="mi">256</span> <span class="c1"># Only used when inclusive=True. Cone/pixel overlapping test performed at resolution fact*nside.</span>

<span class="n">nside_temp</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">disk</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">query_disc</span><span class="p">(</span><span class="n">nside_temp</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">rad1</span><span class="p">),</span> <span class="n">nest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="n">inclusive</span><span class="p">,</span> <span class="n">fact</span><span class="o">=</span><span class="n">fact</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">disk</span></code> is just a list of HEALPixel indices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">disk</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s find the spectrum in <code class="docutils literal notranslate"><span class="pre">disk</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a cutout of l_map and calculate the average spectrum in that cutout:</span>
<span class="n">l_spec_cutout</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span><span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="n">disk</span><span class="p">,</span> <span class="p">:],</span> <span class="n">l_n064</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">][</span><span class="n">disk</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the cutout on the all-sky map, and the extracted spectrum compared to the all-sky average spectrum</span>

<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 14: Vela supernova remnant vs. the sky&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># make a map in which every pixel except those in the cutout is set to NaN</span>
<span class="n">l_n064_map_masked</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">l_n064_map</span><span class="p">)</span> <span class="c1"># We don&#39;t want to alter the original map, so use deepcopy</span>
<span class="n">l_n064_map_masked</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l_n064_map_masked</span><span class="p">)),</span> <span class="n">disk</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># set up the figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="s2">&quot;A;B&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># plot the cutout on the sky</span>
<span class="n">hp</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">l_n064_map_masked</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;L-band [LU]&#39;</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="n">margins</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">)</span>

<span class="c1"># plot the spectrum</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave</span><span class="p">,</span> <span class="n">l_spec_cutout</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave</span><span class="p">,</span> <span class="n">l_n064_spec</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">l_spec_cutout</span><span class="o">/</span><span class="n">l_n064_spec</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 14 image description: Top row shows the all-sky integrated intensity map with all except the Vela supernova remnant blanked out with NaN values. Bottom row shows the Vela average spectrum (red line) with a very strong C IV emission line, overplotted on the average all-sky spectrum (black line) with a weak C IV emission line. </center></div></blockquote>
<p>In the above plot, the red line is the spectrum of Vela, while the black line is the median spectrum of the sky scaled up to match the Vela pseudocontinuum. The C IV emission line is dramatically stronger in Vela than in other sky pixels.</p>
</section>
<section id="spectral-extraction-from-polygons-aquila-rift">
<h3>5. Spectral extraction from polygons (Aquila Rift)<a class="headerlink" href="#spectral-extraction-from-polygons-aquila-rift" title="Permalink to this heading">#</a></h3>
<p>Next, we’ll take a look at the Aquila Rift and environs, to try to reproduce one of the results from <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 15: The Aquila Rift&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="n">lonrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span> <span class="c1"># Galactic longitude range</span>
<span class="n">latrange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="c1"># Galactic latitude range</span>
<span class="n">hp</span><span class="o">.</span><span class="n">cartview</span><span class="p">(</span><span class="n">l_n064_map</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">lonra</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span> <span class="n">latra</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aquila Rift&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 15 image description: The Aquila Rift region at low spatial resolution. Large patches of high and low intensity are observed. </center></div></blockquote>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a> extracted spectra from several different spatial regions in and around the Aquila Rift. Let’s focus on Aquila-Serpens and Aquila-East, which Park et al. found to have very different spectra.</p>
<p>These regions can’t be well-described by a circle, so we’ll use the <code class="docutils literal notranslate"><span class="pre">query_polygon</span></code> function in <code class="docutils literal notranslate"><span class="pre">healpy</span></code> for this, which lets us define a polygon of any degree of complexity (any number of vertices) in the HEALPix scheme.</p>
<p>It would probably be best to use some other software to draw complex polygon regions and obtain the coordinates of the vertices, then load those vertex coordinate lists back into Python/healpy. If you want to move the data to a more versatile image plotting program, you can set <code class="docutils literal notranslate"><span class="pre">return_projected_map=True</span></code> in <code class="docutils literal notranslate"><span class="pre">hp.cartview</span></code> to return a 2-dimensional array containing the above cutout projection.</p>
<p>But for demonstration purposes, we’ll just use the above projection with matplotlib in interactive mode (<code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">notebook</span></code>), reading off the (Galactic longitude, Galactic latitude) numbers in parentheses when we point our cursor at a place where we want a polygon vertex.</p>
<p>We’ll use the Nside=64 data to draw our polygon, where the low resolution helps us see the broad spatial features of the region:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 16: Extraction regions&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># First, let&#39;s draw the polygon for Aquila-Serpens.</span>
<span class="c1"># Transcribing the polygon vertices</span>
<span class="n">aquila_serpens_lon</span> <span class="o">=</span> <span class="p">[</span><span class="mf">27.89</span><span class="p">,</span> <span class="mf">32.2</span><span class="p">,</span> <span class="mf">22.44</span><span class="p">]</span> <span class="c1"># list of Galactic longitude values for the vertices</span>
<span class="n">aquila_serpens_lat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.45</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.7</span><span class="p">]</span> <span class="c1"># list of Galactic latitude values for the vertices, in the same order</span>

<span class="c1"># Now, let&#39;s do the same again to draw a polygon for Aquila-East.</span>
<span class="n">aquila_east_lon</span> <span class="o">=</span> <span class="p">[</span><span class="mf">38.21</span><span class="p">,</span> <span class="mf">33.</span><span class="p">,</span> <span class="mf">33.</span><span class="p">,</span> <span class="mf">34.92</span><span class="p">]</span>
<span class="n">aquila_east_lat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.17</span><span class="p">,</span> <span class="mf">4.66</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]</span>

<span class="c1"># Plotting the vertices of the polygons, with Aquila-Serpens in green and Aquila-East in blue</span>
<span class="n">hp</span><span class="o">.</span><span class="n">cartview</span><span class="p">(</span><span class="n">l_n064_map</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">lonra</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span> <span class="n">latra</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aquila Rift&#39;</span><span class="p">)</span>
<span class="n">hp</span><span class="o">.</span><span class="n">visufunc</span><span class="o">.</span><span class="n">projplot</span><span class="p">(</span><span class="n">aquila_serpens_lon</span><span class="p">,</span> <span class="n">aquila_serpens_lat</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">hp</span><span class="o">.</span><span class="n">visufunc</span><span class="o">.</span><span class="n">projplot</span><span class="p">(</span><span class="n">aquila_east_lon</span><span class="p">,</span> <span class="n">aquila_east_lat</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 16 image description: vertices for 2 extraction regions are overplotted on top of the Aquila Rift image from the previous figure. The region in the lower-left (blue vertices, Aquila-East) is of moderate intensity, but avoids the bright spine that goes through the center of the image. The region in the upper-left (green vertices, Aquila-Serpens) is very low intensity. </center></div></blockquote>
<p>Now that we’ve drawn the polygons, let’s create the polygons with <code class="docutils literal notranslate"><span class="pre">query_polygon</span></code>, and calculate the average spectrum in each polygon. We should use a higher-resolution HEALPix map for this, so that we’re not splitting pixels at the boundaries of the polygons.</p>
<p><strong>Important: This is the recommended workflow. Start with examining low-resolution maps if doing so helps guide the eye, but then switch to high resolution maps for the final calculations (ideally Nside=512), so that the regions you drew will be precisely implemented.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the polygons at a higher-resolution Nside</span>

<span class="c1"># These use &quot;nside_highres&quot; from earlier in this notebook,</span>
<span class="c1"># which is 256 by default, or 512 if you downloaded the full 4.5 GB map.</span>

<span class="n">tempvec</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">ang2vec</span><span class="p">(</span><span class="n">aquila_serpens_lon</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">aquila_serpens_lat</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">aquila_serpens_polygon</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">query_polygon</span><span class="p">(</span><span class="n">nside_highres</span><span class="p">,</span> <span class="n">tempvec</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fact</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">nest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">tempvec</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">ang2vec</span><span class="p">(</span><span class="n">aquila_east_lon</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">aquila_east_lat</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">aquila_east_polygon</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">query_polygon</span><span class="p">(</span><span class="n">nside_highres</span><span class="p">,</span> <span class="n">tempvec</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fact</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">nest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Spatially-averaged spectrum in each polygon</span>
<span class="n">aquila_serpens_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span>
    <span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="n">aquila_serpens_polygon</span><span class="p">,</span> <span class="p">:],</span> 
    <span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">][</span><span class="n">aquila_serpens_polygon</span><span class="p">])</span>
<span class="n">aquila_east_spec</span> <span class="o">=</span> <span class="n">weighted_spatial_average</span><span class="p">(</span>
    <span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;INTEN_BSUB&#39;</span><span class="p">][</span><span class="n">aquila_east_polygon</span><span class="p">,</span> <span class="p">:],</span> 
    <span class="n">l_highres</span><span class="p">[</span><span class="s1">&#39;EXP-SLIT&#39;</span><span class="p">][</span><span class="n">aquila_east_polygon</span><span class="p">])</span>

<span class="c1"># Smoothing the spectra with specutils</span>
<span class="n">specunit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">ph</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span>
<span class="n">smooth_aquila_serpens_spec</span> <span class="o">=</span> <span class="n">specutils</span><span class="o">.</span><span class="n">manipulation</span><span class="o">.</span><span class="n">gaussian_smooth</span><span class="p">(</span>
                            <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">aquila_serpens_spec</span><span class="o">*</span><span class="n">specunit</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">)</span><span class="o">.</span><span class="n">flux</span>
<span class="n">smooth_aquila_east_spec</span> <span class="o">=</span> <span class="n">specutils</span><span class="o">.</span><span class="n">manipulation</span><span class="o">.</span><span class="n">gaussian_smooth</span><span class="p">(</span>
                            <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">aquila_east_spec</span><span class="o">*</span><span class="n">specunit</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">)</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
</div>
<p>First let’s transcribe the approximate wavelengths of the H2 fluorescent Lyman bound–bound emission blend peaks labeled in Fig. 2 of <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1438</span><span class="p">,</span> <span class="mi">1460</span><span class="p">,</span> <span class="mi">1485</span><span class="p">,</span> <span class="mi">1517</span><span class="p">,</span> <span class="mi">1579</span><span class="p">,</span> <span class="mi">1593</span><span class="p">,</span> <span class="mi">1608</span><span class="p">]</span> <span class="c1"># in Angstroms</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s plot the Aquila-Serpens and Aquila-East extraction regions, and the spatially-averaged spectrum in each region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Making versions of the higher-resolution HEALPix map with everything except the polygon set to NaN</span>

<span class="n">aquila_serpens_mask</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">l_highres_map</span><span class="p">)</span> <span class="c1"># We don&#39;t want to alter the original map, so use deepcopy</span>
<span class="n">aquila_serpens_mask</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aquila_serpens_mask</span><span class="p">)),</span> <span class="n">aquila_serpens_polygon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">aquila_east_mask</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">l_highres_map</span><span class="p">)</span>
<span class="n">aquila_east_mask</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aquila_east_mask</span><span class="p">)),</span> <span class="n">aquila_east_polygon</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;&lt;font size=6&gt;Fig. 17: Extracted spectra&lt;/font&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Setting up the figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="s2">&quot;AB;CD&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">minlam</span> <span class="o">=</span> <span class="mi">1400</span>
<span class="n">maxlam</span> <span class="o">=</span> <span class="mi">1650</span>
<span class="n">minf</span> <span class="o">=</span> <span class="mi">900</span>
<span class="n">maxf</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="c1"># Plotting cartesian-projected integrated intensity with a mask that excludes all but the region of interest.</span>
<span class="n">hp</span><span class="o">.</span><span class="n">cartview</span><span class="p">(</span><span class="n">aquila_serpens_mask</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span>
            <span class="n">lonra</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span> <span class="n">latra</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aquila Serpens&#39;</span><span class="p">)</span>
<span class="n">hp</span><span class="o">.</span><span class="n">cartview</span><span class="p">(</span><span class="n">aquila_east_mask</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">8.</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span>
            <span class="n">lonra</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span> <span class="n">latra</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Aquila East&#39;</span><span class="p">)</span>


<span class="c1"># Smoothing and plotting the extracted spectra</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave</span><span class="p">,</span> <span class="n">smooth_aquila_serpens_spec</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minf</span><span class="p">,</span> <span class="n">maxf</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">minlam</span><span class="p">,</span> <span class="n">maxlam</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;photon cm-2 s-1 sr-1 Å-1&#39;</span><span class="p">)</span>
<span class="c1"># Plotting the H2 fluorscent blends as vertical dashed lines</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">h2</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Smoothing and plotting the extracted spectra</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lwave</span><span class="p">,</span> <span class="n">smooth_aquila_east_spec</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">minf</span><span class="p">,</span> <span class="n">maxf</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">minlam</span><span class="p">,</span> <span class="n">maxlam</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;photon cm-2 s-1 sr-1 Å-1&#39;</span><span class="p">)</span>
<span class="c1"># Plotting the H2 fluorscent blends as vertical dashed lines</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">h2</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><center>Fig. 17 image description: the top row shows cutouts of the Aquila-Serpens (left column) and Aquila-East (right column) regions, with the rest of the Aquila Rift image blanked out with NaN values. The cutouts display the high-resolution integrated intensity imaging, with many small dots of light and dark. The bottom row displays the extracted spectrum for each of the two regions. The Aquila-Serpens spectrum exhibits emission features that line up with vertical lines denoting H2 fluorescent line blends, while Aquila-East spectrum's features do not line up with these vertical lines.</center></div></blockquote>
<p>The vertical dashed lines above are representative wavelengths of H2 fluorescent line blends, transcribed from Fig. 2 of <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a>.</p>
<p>We appear to have reproduced the <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a> result that H2 fluorescent emission lines are more clearly seen in Aquila-Serpens (left) than Aquila-East (right) — with the codicil that we have not re-done the full analysis, and H2 emission has complex spectral and spatial morphologies. According to <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a>, stronger H2 emission in Aquila-Serpens is due to higher density, molecular hydrogen column density, and excitation temperature, consistent with proximity to star formation.</p>
<p>From here, you are ready to explore on your own!</p>
</section>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Authors:</strong></p>
<p>Adrian Lucy, STScI, alucy&#64;stsci.edu</p>
<p>Kwang-Il Seon, KASI/UST</p>
<p>Young-Soo Jo, KASI</p>
<p>Eric Korpela, UC Berkeley</p>
<p>Martin Sirk, UC Berkeley</p>
<p>Jerry Edelstein, UC Berkeley</p>
<p><strong>Acknowledgements:</strong></p>
<p>Formatting for this notebook is based on the <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">Universe!</span></code> notebooks created by Claire Murray (STScI).</p>
<p>Science content in the Aquila Rift section is based on <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Park et al. 2012</a>.</p>
<p><strong>Updated On:</strong> 2023-04-11</p>
<p>For support, please contact the Archive HelpDesk at archive&#64;stsci.edu.</p>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">#</a></h2>
<p>If you use this data set or the imported modules for published research, please cite the authors. Follow these links for more information:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://outerspace.stsci.edu/display/SPEARFIMS/How+to+Cite">Citing the dataset</a></p></li>
<li><p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...754...10P/abstract">Citing the Aquila Rift analysis</a></p></li>
<li><p><a class="reference external" href="https://github.com/healpy/healpy/blob/main/CITATION">Citing healpy</a></p></li>
<li><p><a class="reference external" href="https://www.astropy.org/acknowledging.html">Citing astropy</a></p></li>
<li><p><a class="reference external" href="https://github.com/astropy/specutils/blob/main/specutils/CITATION">Citing specutils</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/users/project/citing.html">Citing matplotlib</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/MCCM/FIMS-SPEAR/hyperspectral_healpix_maps"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../../../K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)</p>
      </div>
    </a>
    <a class="right-next"
       href="../../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">MAST Table Access Protocol PanSTARRS 1 DR2 Demo</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial">Tutorial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-wrangle-the-data">1. Download and wrangle the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#all-sky-maps-and-spectra">2. All-sky maps and spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slicing-and-rotating-comparing-fims-vs-spear-data">3. Slicing and rotating (Comparing FIMS vs. SPEAR data)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cartesian-projections-and-spectrum-extraction-from-circles-vela-supernova-remnant">4. Cartesian projections and spectrum extraction from circles (Vela Supernova Remnant)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spectral-extraction-from-polygons-aquila-rift">5. Spectral extraction from polygons (Aquila Rift)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>